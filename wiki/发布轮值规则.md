## 发布轮值规则

1. 发布前确保的相关工作。
   - 一些简单明确的 issue 和 pr 已被处理和合并。
   - 重装 node_modules (删掉`package-lock.json`/`yarn.lock`文件、并使用`npm`安装)，这样确保依赖的 rmc/rc 组件版本在向下兼容的前提下升级到最新（另参看 [david 版本过期服务](https://david-dm.org/ant-design/ant-design-mobile)），升级后对演示进行基本的人工检查。
   - 保证 `npm run test:all` 通过。
2. 如无特殊需求，每**周五**发布一个 `patch` 版本，也可按照具体改动判断是否发布 `minor` 版本。`major` 版本发布不遵循此规则。
3. **发布进行按周轮值**，从 2018 年 5 月 21 日起，按照 @kgtong @ziluo ... 的顺序轮流开始。
4. 轮值人当周负责
   - **及时进行 PR Reveiew 的分配和合并操作**。（不要合并 `In Progress` `WIP` 的 PR）
   - 定位、分配、跟踪需要解决的 Issue。
   - 关闭已解决或无法解决的 Issue。
   - 按时进行新版本发布。
   - 标签的使用：比如 `Need Reproduce` 用于没有提供重现的 issue。

## 团队

你可以分配 issue 和 pull request 的用户包括：

- @kgtong @ziluo @micooz @likezero @doxiaodong @skidxjq

## 流程

### 1. 编辑 CHANGELOG.md & package.json

- 在 CHANGELOG.md 里添加发布日志，可以用 [compare](https://github.com/ant-design/ant-design-mobile/compare/1.0.1...master) 功能找到当前和之前版本的区别，将有价值的改动如实反馈给用户。
  - 用面向开发者的角度和叙述方式撰写 CHANGELOG，不描述修复细节，描述问题和对开发者的影响。
  - 尽量给出原始的 issue 或 PR 链接，社区提交的 PR 改动加上提交者的链接。
  - 底层模块升级中间版本要给出变动说明。
- 在 package.json 里修改 version 为此次发布的版本号，按照语义化版本进行升级，`bugfix` 升级小版本（`patch`），新功能添加升级中间的版本号（`minor`）。
- 提交此次修改。

> 注：底层 rmc/rc 组件的小版本修复，可以不用写入 changelog。

### 2. npm 发布

发布前确保 node_modules 目录是重装后`最新`的，并且 `npm run test:all` 是通过的。
> 使用 `git clean -xdf` 命令能一次删掉 `package-lock` / `yarn.lock` / `编译生成的js文件或目录` 等 .gitignore 里写的所有无关内容

- 在项目根目录下执行：

  ```bash
  npm run pub  # 如果不成功，可能需要翻墙
  ```

### 3. Github Tag/releases

- 首先确保步骤二`npm run pub`发布成功，检查已发布版本的 tag 已成功创建([ref tags](https://github.com/ant-design/ant-design-mobile/tags))。然后在 Github 上 **[releases](https://github.com/ant-design/ant-design-mobile/releases)** 页面来进行 release note 的编辑。
- 标题填写发布的版本号，填写 CHANGELOG 的内容。注意需要包含中英文改动，英文在前，用 `---` 分隔。
- 最后点击左下角绿色的 **Publish release** 按钮发布。

### 4. 发布网站

```bash
npm run deploy
```

> 为了确保部署时的依赖是最新的，在运行上述命令时，建议先 `rm -rf node_modules && npm i`(注意先删掉`package-lock.json`/`yarn.lock`文件)。

- **必须** 对此次发布 **改动到的组件** 以及 **InputItem / List / ListView / Modal / Tabs** 等复杂或常用组件，在 网站(preact / react 手机真机环境) 以及 [samples](https://github.com/ant-design/antd-mobile-samples/tree/master/web-webpack3) 里进行再次验证，以确保没有问题。

- 执行完上面的命令后，整个发布过程结束。

### 5. 合并 `master` 到 `feature-x` 分支

每次发版确认一切正常后，应及时合并 `master` 进某个 feature 的开发分支。

如果发布的是 minor 版本，则需要删除旧的 `feature-x.x` 分支，并 checkout 出下一个 `feature-x.x` 分支。
